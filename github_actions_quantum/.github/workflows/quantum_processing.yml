name: 🌌 Quantum BDI Agent Processing

on:
  repository_dispatch:
    types: [quantum-processing]
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:
    inputs:
      processing_type:
        description: 'Processing Type'
        required: true
        default: 'full_cycle'
        type: choice
        options:
          - full_cycle
          - belief_only
      data_source:
        description: 'Data Source'
        required: false
        default: 'termux_trigger'

jobs:
  quantum-belief-processing:
    name: 🧠 Quantum Belief Processing
    runs-on: ubuntu-latest
    outputs:
      belief_results_path: ${{ steps.process_beliefs.outputs.summary_file }}
    steps:
      - name: 🚀 Checkout Repository
        uses: actions/checkout@v4
      - name: 🐍 Setup Python Quantum Environment
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      - name: ⚡ Install Quantum Dependencies
        run: |
          pip install qiskit numpy scipy scikit-learn pandas requests
      - name: 🌌 Process Quantum Beliefs
        id: process_beliefs
        run: |
          python github_actions_quantum/quantum/belief_quantum.py
          echo "summary_file=artifacts/belief_data/$(ls -t artifacts/belief_data | grep summary | head -n 1)" >> $GITHUB_OUTPUT
      - name: 📤 Upload Belief Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: belief-results
          path: artifacts/belief_data/

  quantum-desire-optimization:
    name: 💫 Quantum Desire Optimization
    runs-on: ubuntu-latest
    needs: quantum-belief-processing
    outputs:
      desire_results_path: ${{ steps.optimize_desires.outputs.summary_file }}
    steps:
      - name: 🚀 Checkout Repository
        uses: actions/checkout@v4
      - name: 🐍 Setup Python Environment
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: ⚡ Install Dependencies
        run: pip install qiskit numpy scipy scikit-learn pandas networkx
      - name: 📥 Download Belief Artifacts
        uses: actions/download-artifact@v3
        with:
          name: belief-results
          path: artifacts/belief_data/
      - name: 🌌 Run QAOA Desire Optimization
        id: optimize_desires
        run: |
          python github_actions_quantum/quantum/desire_quantum.py --belief-file ${{ needs.quantum-belief-processing.outputs.belief_results_path }}
          echo "summary_file=artifacts/desire_data/$(ls -t artifacts/desire_data | grep summary | head -n 1)" >> $GITHUB_OUTPUT
      - name: 📤 Upload Desire Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: desire-results
          path: artifacts/desire_data/

  quantum-intention-planning:
    name: 🎯 Quantum Intention Planning
    runs-on: ubuntu-latest
    needs: quantum-desire-optimization
    steps:
      - name: 🚀 Checkout Repository
        uses: actions/checkout@v4
      - name: 🐍 Setup Python Environment
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: ⚡ Install Dependencies
        run: pip install qiskit numpy scipy scikit-learn pandas networkx
      - name: 📥 Download Desire Artifacts
        uses: actions/download-artifact@v3
        with:
          name: desire-results
          path: artifacts/desire_data/
      - name: 🌌 Execute Quantum Intention Planning
        id: plan_intentions
        run: |
          python github_actions_quantum/quantum/intention_quantum.py --desire-file ${{ needs.quantum-desire-optimization.outputs.desire_results_path }}
      - name: 📤 Upload Intention Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: intention-results
          path: artifacts/intention_data/
